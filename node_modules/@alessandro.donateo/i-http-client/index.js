var i_log = require("i-log")("HTTP_client");
var http = require('http');


var get = function(remoteOption, nameTread , callback){
	if(!remoteOption) i_log.error(nameTread + " missing remoteOption. thred exit")
	else if(!callback) i_log.error(nameTread + " missing callback handler. thred exit")
	else  doGet(remoteOption, callback)
}


var doGet = function(remoteOption, callback){
	
	requestHandler = function(response) {
	  var str = '';
	  response.on('data', function (chunk) {
		    str += chunk;
		  });
	  response.on('uncaughtException', function (err) {
	    i_log.log(err);
	    callback(err);
	  });
	  //the whole response has been recieved, so we just print it out here
	  response.on('end', function () {
			i_log.debug(str);
	    callback(null, str);
	  });
	}
	
	http.request(remoteOption,requestHandler).end();
}

var post = function(remoteOption, nameTread , body, callback){
	if(!remoteOption) i_log.error(nameTread + " missing remoteOption. thred exit")
	else if(!callback) i_log.error(nameTread + " missing callback handler. thred exit")
	else  doPost(remoteOption, body, callback)
}


var doPost = function(remoteOption, body, callback){
	
	requestHandler = function(response) {
	  var str = '';
	  response.on('data', function (chunk) {
		    str += chunk;
		  });
	  response.on('uncaughtException', function (err) {
	    i_log.log(err);
	    callback(err);
	  });
	  //the whole response has been recieved, so we just print it out here
	  response.on('end', function () {
			i_log.debug(str);
	    callback(null, str);
	  });
	}
	
	http.request(remoteOption,requestHandler).end(body);
}

module.exports = {
		get: get,
		post:post
	};



